<!DOCTYPE html>
<html>
<head>
  <title>locator_test.html</title>
  <script src="bot-bootstrap.js"></script>
  <script>
    goog.require('goog.testing.jsunit');
    goog.require('goog.events.EventType');
    goog.require('bot.locators');
  </script>

  <script>
    function testCanFindById() {
      var e = bot.locators.findElement({id: 'x'});

      assertEquals('para', e.getAttribute('name'));
    }

    function testCanFindByIdWhenElementIsAfterOneWithSameName() {
      var e = bot.locators.findElement({id: 'after'});

      assertEquals('right', e.getAttribute('name'));
    }

    function testCanFindByNameOutsideOfAForm() {
      var e = bot.locators.findElement({name: 'para'});

      assertEquals('x', e.getAttribute('id'));
    }

    function testWillNotFindAnElementByNameWhereNoMatchShouldBeFound() {
      assertNull(bot.locators.findElement({name: 'foobar'}));
    }

    function testCanFindByClassName() {
      var dogs = bot.locators.findElement({className: 'dogs'});
      assertNotNull(dogs);
      assertEquals('after', dogs.id);
    }

    function testCannotSearchWithCompoundClassNames() {
      assertThrows(goog.bind(bot.locators.findElement, null,
          {className: 'feline cats'}));
    }

    function testFindByClassNameReturnsFirstMatchingElement() {
      var cats = bot.locators.findElement({className: 'cats'});
      assertNotNull(cats);
      assertEquals('wrong', cats.id);
    }

    function testCanFindByAnyOfAnElementsClassNames() {
      var felines = bot.locators.findElement({className: 'feline'});
      var cats = bot.locators.findElement({className: 'cats'});

      assertEquals(felines, cats);
      assertEquals('wrong', cats.id);
    }

    function testFindByClassNameReturnsNullIfNoMatchIsFound() {
      assertNull(bot.locators.findElement({className: 'catsAndDogs'}));
    }

    function testCanFindElementByCssSelector() {
      var after = bot.locators.findElement({css: '#wrong'});

      assertNotNull(after);
      assertEquals('wrong', after.id);
    }

    function testShouldReturnNullIfNoCssMatchIsFound() {
      assertNull(bot.locators.findElement({css: '#uglyfish'}))
    }

    function testWillRejectShouldRejectMultipleSelectors() {
      assertThrows(goog.bind(bot.locators.findElement, null,
          {css: '.one, #two'}));
    }

    function testCanLocateElementsUsingXPath() {
      var doggies = bot.locators.findElement({xpath: "//*[@id = 'after']"});

      assertNotNull(doggies);
      assertEquals('after', doggies.id);
    }

    function testWillReturnNullIfNoMatchUsingXPathIsFound() {
      assertNull(bot.locators.findElement({xpath: "//fish"}));
    }

    function testCanFindMoreThanOneElementByName() {
      var allFoos = bot.locators.findElements({name: 'foo'});

      assertEquals(2, allFoos.length);
    }

    function testCanFindManyElementsUsingCss() {
      var cats = bot.locators.findElements({css: '.cats'});

      assertEquals(3, cats.length);
    }

    function testCanFindManyElementsUsingClassName() {
      var cats = bot.locators.findElements({className: 'cats'});

      assertEquals(3, cats.length);
    }

    function testCanFindManyElementsUsingAnId() {
      var bad = bot.locators.findElements({id: 'illegal'});

      assertEquals(4, bad.length);
    }

    function testCanFindManyElementsViaXPath() {
      var bad = bot.locators.findElements({xpath: '//*[@name = "after"]'});

      assertEquals(2, bad.length);
    }

    function testCanFindElementByLinkText() {
      var link = bot.locators.findElement({link: 'this is a link'});

      assertEquals('link', bot.dom.getAttribute(link, 'id'));
    }

    function testCanFindElementsByLinkText() {
      var links = bot.locators.findElements({link: 'this is a link'});

      assertEquals(5, links.length);
    }

    function testCanFindElementByPartialLinkText() {
      var link = bot.locators.findElement({partialLink: 'is a'});

      assertEquals('link', bot.dom.getAttribute(link, 'id'));
    }

    function testCanFindElementsByPartialLinkText() {
      var links = bot.locators.findElements({partialLink: 'a lin'});

      assertEquals(5, links.length);
    }
  </script>
</head>
<body>
  <p id="x" name="para">Para</p>

  <div name="after" id="wrong" class="feline cats">nope</div>
  <div name="right" id="after" class="dogs">yup</div>
  <div name="lion" class="cats">simba</div>
  <div name="tiger" class="cats">shere khan</div>

  <form action="#">
    <input name="after" /><br />
    <input name="foo" />
  </form>

  <span name="foo">Furrfu</span>

  <ul>
    <li id="illegal">item
    <li id="illegal">item
    <li id="illegal">item
    <li id="illegal">item
  </ul>

  <a id="link" href="#">this is a link</a>
  <a name="fishsticks">this is a link</a>
  <a href="#">this is a link</a>
  <a href="#">this is a link</a>
  <a href="#">this is a link</a>
</body>
</html>