<!DOCTYPE html>
<html>
<head>
  <title>locator_test.html</title>
  <script src="bot-bootstrap.js"></script>
  <script>
    goog.require('goog.testing.jsunit');
    goog.require('goog.events.EventType');
    goog.require('bot.locators');
  </script>

  <script type="text/javascript">
    var h=this;
    function i(a){var b=typeof a;if(b=="object")if(a){if(a instanceof Array||!(a instanceof Object)&&Object.prototype.toString.call(a)=="[object Array]"||typeof a.length=="number"&&typeof a.splice!="undefined"&&typeof a.propertyIsEnumerable!="undefined"&&!a.propertyIsEnumerable("splice"))return"array";if(!(a instanceof Object)&&(Object.prototype.toString.call(a)=="[object Function]"||typeof a.call!="undefined"&&typeof a.propertyIsEnumerable!="undefined"&&!a.propertyIsEnumerable("call")))return"function"}else return"null";else if(b==
    "function"&&typeof a.call=="undefined")return"object";return b}function k(a){return i(a)=="function"}function l(a,b){var c=b||h;if(arguments.length>2){var e=Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(d,e);return a.apply(c,d)}}else return function(){return a.apply(c,arguments)}};var m=Array.prototype,n=m.indexOf?function(a,b,c){return m.indexOf.call(a,b,c)}:function(a,b,c){for(c=c==null?0:c<0?Math.max(0,a.length+c):c;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},q=m.filter?function(a,b,c){return m.filter.call(a,b,c)}:function(a,b,c){for(var e=a.length,d=[],f=0,g=typeof a=="string"?a.split(""):a,j=0;j<e;j++)if(j in g){var u=g[j];if(b.call(c,u,j,a))d[f++]=u}return d};
    function r(a,b,c){a:{for(var e=a.length,d=typeof a=="string"?a.split(""):a,f=0;f<e;f++)if(f in d&&b.call(c,d[f],f,a)){b=f;break a}b=-1}return b<0?null:typeof a=="string"?a.charAt(b):a[b]};function s(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")}
    function t(a,b){var c=0;a=s(String(a)).split(".");b=s(String(b)).split(".");for(var e=Math.max(a.length,b.length),d=0;c==0&&d<e;d++){var f=a[d]||"",g=b[d]||"",j=new RegExp("(\\d*)(\\D*)","g"),u=new RegExp("(\\d*)(\\D*)","g");do{var o=j.exec(f)||["","",""],p=u.exec(g)||["","",""];if(o[0].length==0&&p[0].length==0)break;c=v(o[1].length==0?0:parseInt(o[1],10),p[1].length==0?0:parseInt(p[1],10))||v(o[2].length==0,p[2].length==0)||v(o[2],p[2])}while(c==0)}return c}
    function v(a,b){if(a<b)return-1;else if(a>b)return 1;return 0}(Date.now||function(){return+new Date})();var w,x,y,z;function A(){return h.navigator?h.navigator.userAgent:null}z=y=x=w=false;var B;if(B=A()){var C=h.navigator;w=B.indexOf("Opera")==0;x=!w&&B.indexOf("MSIE")!=-1;y=!w&&B.indexOf("WebKit")!=-1;z=!w&&!y&&C.product=="Gecko"}var D=x,E=z,F=y,G,H="",I;if(w&&h.opera){var J=h.opera.version;H=typeof J=="function"?J():J}else{if(E)I=/rv\:([^\);]+)(\)|;)/;else if(D)I=/MSIE\s+([^\);]+)(\)|;)/;else if(F)I=/WebKit\/(\S+)/;if(I){var K=I.exec(A());H=K?K[1]:""}}G=H;var L={};F&&(L["522"]||(L["522"]=t(G,"522")>=0));function M(a){return a.nodeType==9?a:a.ownerDocument||a.document}function N(a){this.d=a||h.document||document}
    N.prototype.c=function(a,b,c){var e=this.d;c=c||e;a=a&&a!="*"?a.toLowerCase():"";if(c.querySelectorAll&&(a||b)&&(!F||e.compatMode=="CSS1Compat"||L["528"]||(L["528"]=t(G,"528")>=0)))b=c.querySelectorAll(a+(b?"."+b:""));else if(b&&c.getElementsByClassName){e=c.getElementsByClassName(b);if(a){c={};for(var d=0,f=0,g;g=e[f];f++)if(a==g.nodeName.toLowerCase())c[d++]=g;c.length=d;b=c}else b=e}else{e=c.getElementsByTagName(a||"*");if(b){c={};for(f=d=0;g=e[f];f++){a=g.className;if(typeof a.split=="function"&&
    n(a.split(" "),b)>=0)c[d++]=g}c.length=d;b=c}else b=e}return b};var O={};O.b=function(a,b){if(!b)throw Error("No class name specified");b=s(b);if(b.split(/\s+/).length>1)throw Error("Compound class names not permitted");a=(new N(a.document)).c("*",b);if(a.length>0)return a[0];return null};O.a=function(a,b){if(!b)throw Error("No class name specified");b=s(b);if(b.split(/\s+/).length>1)throw Error("Compound class names not permitted");return(new N(a.document)).c("*",b)};var P={};P.b=function(a,b){a=a.document;if(!k(a.querySelector))throw Error("CSS selection is not supported");if(!b)throw Error("No selector specified");if(b.split(/,/).length>1)throw Error("Compound selectors not permitted");b=s(b);return(b=a.querySelector(b))?b:null};P.a=function(a,b){a=a.document;if(!k(a.querySelectorAll))throw Error("CSS selection is not supported");if(!b)throw Error("No selector specified");if(b.split(/,/).length>1)throw Error("Compound selectors not permitted");b=s(b);return a.querySelectorAll(b)};var Q=["checked","disabled","readOnly","selected"];function R(a,b){var c=b.toLowerCase();if("style"==c)return"";if("class"==c)b="className";if("readonly"==c)b="readOnly";var e;a:{c=b;if(k(a.hasAttribute))if(a.hasAttribute(c)){e=true;break a}for(e in a)if(c==e){e=true;break a}e=false}if(!e)return null;a=a[b]===undefined?a.getAttribute(b):a[b];if(n(Q,b)>=0)a=a!=""&&a!="false"&&a!=false;return a};var S={};S.b=function(a,b){a=M(a);var c=a.getElementById(b);if(!c)return null;if(c.getAttribute("id")==b)return c;a=a.getElementsByTagName("*");c=a.length;for(var e=0;e<c;e++){var d=a[e];if(d.tagName.toLowerCase()=="form"){if(d.attributes.id.nodeValue==b)return d}else if(R(d,"id")==b)return d}return null};S.a=function(a,b){a=M(a).getElementsByTagName("*");return q(a,function(c){return R(c,"id")==b})};var T={};T.b=function(a,b){a=M(a);if(a.getElementsByName)for(var c=a.getElementsByName(b),e=c.length,d=0;d<e;d++)if(c[d].getAttribute("name")===b)return c[d];a=a.getElementsByTagName("*");return r(a,function(f){return R(f,"name")==b})};T.a=function(a,b){a=M(a).getElementsByTagName("*");return q(a,function(c){return R(c,"name")==b})};var U={};U.b=function(a,b){a=M(a);if(!k(a.evaluate))throw Error("XPath location is not supported");if(!b)throw Error("No xpath specified");return(b=a.evaluate(b,a,null,9,null).singleNodeValue)?b:null};U.a=function(a,b){a=M(a);if(!k(a.evaluate))throw Error("XPath location is not supported");if(!b)throw Error("No xpath specified");b=a.evaluate(b,a,null,5,null);a=[];for(var c=b.iterateNext();c;){a.push(c);c=b.iterateNext()}return a};var V={className:O,css:P,id:S,name:T,xpath:U};var W=function(a){a:{var b;b:{for(b in a){b=b;break b}b=void 0}if(b){var c=V[b];if(c&&k(c.a)){a=l(V[b].a,null,h,a[b]);break a}}throw new Error("Unsupported locator strategy: "+b);}return a()},X="findElements".split("."),Y=h;!(X[0]in Y)&&Y.execScript&&Y.execScript("var "+X[0]);for(var Z;X.length&&(Z=X.shift());)if(!X.length&&W!==undefined)Y[Z]=W;else Y=Y[Z]?Y[Z]:(Y[Z]={});
    
  </script>


  <script>
    function testCanFindById() {
      var e = bot.locators.findElement({id: 'x'});

      assertEquals('para', e.getAttribute('name'));
    }

    function testCanFindByIdWhenElementIsAfterOneWithSameName() {
      var e = bot.locators.findElement({id: 'after'});

      assertEquals('right', e.getAttribute('name'));
    }

    function testCanFindByNameOutsideOfAForm() {
      var e = bot.locators.findElement({name: 'para'});

      assertEquals('x', e.getAttribute('id'));
    }

    function testWillNotFindAnElementByNameWhereNoMatchShouldBeFound() {
      assertNull(bot.locators.findElement({name: 'foobar'}));
    }

    function testCanFindByClassName() {
      var dogs = bot.locators.findElement({className: 'dogs'});
      assertNotNull(dogs);
      assertEquals('after', dogs.id);
    }

    function testCannotSearchWithCompoundClassNames() {
      assertThrows(goog.bind(bot.locators.findElement, null,
          {className: 'feline cats'}));
    }

    function testFindByClassNameReturnsFirstMatchingElement() {
      var cats = bot.locators.findElement({className: 'cats'});
      assertNotNull(cats);
      assertEquals('wrong', cats.id);
    }

    function testCanFindByAnyOfAnElementsClassNames() {
      var felines = bot.locators.findElement({className: 'feline'});
      var cats = bot.locators.findElement({className: 'cats'});

      assertEquals(felines, cats);
      assertEquals('wrong', cats.id);
    }

    function testFindByClassNameReturnsNullIfNoMatchIsFound() {
      assertNull(bot.locators.findElement({className: 'catsAndDogs'}));
    }

    function testCanFindElementByCssSelector() {
      var after = bot.locators.findElement({css: '#wrong'});

      assertNotNull(after);
      assertEquals('wrong', after.id);
    }

    function testShouldReturnNullIfNoCssMatchIsFound() {
      assertNull(bot.locators.findElement({css: '#uglyfish'}))
    }

    function testWillRejectShouldRejectMultipleSelectors() {
      assertThrows(goog.bind(bot.locators.findElement, null,
          {css: '.one, #two'}));
    }

    function testCanLocateElementsUsingXPath() {
      var doggies = bot.locators.findElement({xpath: "//*[@id = 'after']"});

      assertNotNull(doggies);
      assertEquals('after', doggies.id);
    }

    function testWillReturnNullIfNoMatchUsingXPathIsFound() {
      assertNull(bot.locators.findElement({xpath: "//fish"}));
    }

    function testCanFindMoreThanOneElementByName() {
      var allFoos = bot.locators.findElements({name: 'foo'});

      assertEquals(2, allFoos.length);
    }

    function testCanFindManyElementsUsingCss() {
      var cats = bot.locators.findElements({css: '.cats'});

      assertEquals(3, cats.length);
    }

    function testCanFindManyElementsUsingClassName() {
      var cats = bot.locators.findElements({className: 'cats'});

      assertEquals(3, cats.length);
    }

    function testCanFindManyElementsUsingAnId() {
      var bad = bot.locators.findElements({id: 'illegal'});

      assertEquals(4, bad.length);
    }

    function testCanFindManyElementsViaXPath() {
      var bad = bot.locators.findElements({xpath: '//*[@name = "after"]'});

      assertEquals(2, bad.length);
    }
  </script>
</head>
<body>
  <p id="x" name="para">Para</p>

  <div name="after" id="wrong" class="feline cats">nope</div>
  <div name="right" id="after" class="dogs">yup</div>
  <div name="lion" class="cats">simba</div>
  <div name="tiger" class="cats">shere khan</div>

  <form action="#">
    <input name="after" /><br />
    <input name="foo" />
  </form>

  <span name="foo">Furrfu</span>

  <ul>
    <li id="illegal">item
    <li id="illegal">item
    <li id="illegal">item
    <li id="illegal">item
  </ul>
</body>
</html>