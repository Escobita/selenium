<?xml version="1.0"?>

<cruisecontrol>
    <property file="cc-config/platform.specific.properties"/>

    <property name="score.dir" value="${cc.dir}/checkout/score" />
    <property name="src.dir" value="${cc.dir}/checkout/src" />
    <property name="cruise.build.artifacts.dir" value="${cc.dir}/artifacts" />

    <project name="selenium_core.build.${platform.name}" buildafterfailed="true">
	<property name="cruise.build.artifacts.dir" value="${cc.dir}/artifacts" />

	<labelincrementer defaultLabel="${project.name}-1" separator="-"/>

	<listeners>
	    <currentbuildstatuslistener file="${cc.dir}/logs/${project.name}/currentbuildstatus.txt" />
	</listeners>

	<bootstrappers>
	    <svnbootstrapper localWorkingCopy="${score.dir}"/>
	</bootstrappers>	

	<modificationset quietperiod="30">
	    <svn LocalWorkingCopy="${score.dir}" />
	</modificationset>

	<schedule>
	    <ant antWorkingDir="${score.dir}" 
		antscript="${ant.script}"
		buildfile="ccbuild.xml" 
		target="all" 
		uselogger="true"
		tempfile="${project.name}-log.xml"
		timeout= "1200" />
	</schedule>

	<log>
	    <merge file="${score.dir}/code/logs/SeleniumResults.xml"/>
	    <merge file="${score.dir}/code/logs/JsUnitResults.xml"/>
	</log>
    </project>

    <project name="selenium.build.${platform.name}" buildafterfailed="true">
	<property name="cruise.build.artifacts.dir" value="${cc.dir}/artifacts" />

	<labelincrementer defaultLabel="${project.name}-1" separator="-"/>

	<listeners>
	    <currentbuildstatuslistener file="${cc.dir}/logs/${project.name}/currentbuildstatus.txt" />
	</listeners>

	<bootstrappers>
	    <svnbootstrapper localWorkingCopy="${src.dir}"/>
	</bootstrappers>	

	<modificationset quietperiod="30">
	    <svn LocalWorkingCopy="${src.dir}"/>
	    <svn LocalWorkingCopy="${score.dir}" />
	</modificationset>

	<schedule>
	    <ant antWorkingDir="${src.dir}" 
		antscript="${ant.script}"
		buildfile="ccbuild.xml" 
		target="cruise" 
		uselogger="true"
		tempfile="${project.name}-log.xml"
		timeout="3600" />
	</schedule>

	<log>
	    <!-- how to merge more test results? (e.g. NUnit test results) -->
	    <merge file="${src.dir}/server/target/surefire-reports/TEST-org.openqa.selenium.ServerTestSuite.xml"/>
	    <merge file="${src.dir}/clients/java/target/surefire-reports/TEST-org.openqa.selenium.ClientDriverSuite.xml"/>
	    <merge file="${src.dir}/xlator/target/surefire-reports/TEST-org.openqa.selenium.XlatorTaskTest.xml"/>
	    <merge file="${src.dir}/xlator/target/surefire-reports/TEST-org.openqa.selenium.XlatorTest.xml"/>
	</log>

	<publishers>
	    <artifactspublisher
		file="${score.dir}/code/score-build.log"
		dest="artifacts/${project.name}" />
	    <artifactspublisher
		file="${src.dir}/src-build.log"
		dest="artifacts/${project.name}" />
	    <onsuccess>	
		<artifactspublisher
		    file="${score.dir}/code/build/dist/selenium-core.jar"
		    dest="artifacts/${project.name}" />
		<artifactspublisher
		    dir="${src.dir}/clients/dist"
		    dest="artifacts/${project.name}"
		    subdirectory="dist" />
		<artifactspublisher
		    dir="${src.dir}/clients/dist-doc"
		    dest="artifacts/${project.name}"
		    subdirectory="dist-doc" />
	    </onsuccess>
	    <htmlemail
		buildresultsurl="http://localhost/buildresults/${project.name}?tab=buildResults"
		mailhost="localhost"
		returnaddress="${return.mail.address}"
		xslfile="${result.xsl}"
		spamwhilebroken="false"
		skipusers="true" >
		<always address="selenium-dev@openqa.org" /> 
		<always address="alex.hal9000@gmail.com" />
	    </htmlemail>
	    <!-- maybe publish browser test results -->
	</publishers>
    </project>

</cruisecontrol>
